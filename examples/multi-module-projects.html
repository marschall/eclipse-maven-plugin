<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/apt/examples/multi-module-projects.apt.vm at 2019-06-27
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Roland Asmann
Richard van Nieuwenhoven" />
    <meta name="Date-Creation-yyyymmdd" content="20071017" />
    <meta name="Date-Revision-yyyymmdd" content="20190627" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Apache Maven Eclipse Plugin &#x2013; Multi-module projects with WTP</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/marschall/maven-eclipse-plugin">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Apache Maven Eclipse Plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-06-27<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.11.2</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../plugin-info.html" title="Goals"><span class="none"></span>Goals</a></li>
    <li><a href="../usage.html" title="Usage"><span class="none"></span>Usage</a></li>
    <li><a href="../changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../trouble-shooting/index.html" title="Trouble Shooting"><span class="none"></span>Trouble Shooting</a></li>
    <li><a href="http://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
      <li class="nav-header">Configuration</li>
    <li><a href="../reactor.html" title="Multiple Module Projects"><span class="none"></span>Multiple Module Projects</a></li>
    <li><a href="../wtp.html" title="WTP Support"><span class="none"></span>WTP Support</a></li>
      <li class="nav-header">Examples</li>
    <li><a href="../examples/additional-facets.html" title="Adding additional facets"><span class="none"></span>Adding additional facets</a></li>
    <li><a href="../examples/attach-library-sources.html" title="Attach Library Sources"><span class="none"></span>Attach Library Sources</a></li>
    <li><a href="../examples/configure-checkstyle.html" title="Configure Checkstyle"><span class="none"></span>Configure Checkstyle</a></li>
    <li><a href="../examples/load-code-styles.html" title="Load Code Style file"><span class="none"></span>Load Code Style file</a></li>
    <li class="active"><a href="#"><span class="none"></span>Multi-module projects with WTP</a></li>
    <li><a href="../examples/prevent-module-references.html" title="Prevent Module References"><span class="none"></span>Prevent Module References</a></li>
    <li><a href="../examples/provide-project-natures-and-build-commands.html" title="Provide Project Natures And Build Commands"><span class="none"></span>Provide Project Natures And Build Commands</a></li>
    <li><a href="../examples/specifying-source-path-inclusions-and-exclusions.html" title="Specifying source path inclusions and exclusions"><span class="none"></span>Specifying source path inclusions and exclusions</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Using_maven-eclipse-plugin_in_multi-module_projects_with_WTP"></a>Using maven-eclipse-plugin in multi-module projects with WTP</h2>
<p>Developing Multi-module projects with Maven and Eclipse can be done efficiently using the the best of both Maven 2 and Eclipse's WTP. </p>
<p>Especially with projects that have EJB and EAR modules, it can be difficult to use Maven 2.0 and WTP. There are however good solutions to these obstacles, without losing any of the functionality of either Maven nor WTP.</p>
<div class="section">
<h3><a name="The_flat_project_structure"></a>The flat project structure</h3>
<p>One of the major problems that occur when using Maven and Eclipse together, is that Maven encourages the use of deep project structures, whereas eclipse can't handle those. A solution to this problem is to force Maven to use the flat structure:</p>
<div class="source"><pre class="prettyprint">.....
&lt;modules&gt;
  &lt;module&gt;../module1&lt;/module&gt;
  &lt;module&gt;../module2&lt;/module&gt;
&lt;/modules&gt;
.....</pre></div>
<p>This has some very big drawbacks: You will lose the possibility to use several of Maven's tools (eg the release-plugin), because these are unable to handle flat structures.</p>
<p>The best approach is to do everything the way it was intended in Maven, and let the maven-eclipse-plugin bend WTP to its will. Therefore, the recommendation would be to use the deep structures:</p>
<div class="source"><pre class="prettyprint">.....
&lt;modules&gt;
  &lt;module&gt;module1&lt;/module&gt;
  &lt;module&gt;module2&lt;/module&gt;
&lt;/modules&gt;
.....</pre></div></div>
<div class="section">
<h3><a name="The_Example_project"></a>The Example project</h3>
<p>This project is an example of a multi-module projects, containing some JAR-, a WAR- and an EAR-project. You can download it from <a href="./j2ee-simple.tar.gz">here</a>. The project is based on the j2ee-simple archetype.</p>
<div class="section">
<h4><a name="Step_by_step"></a>Step by step</h4>
<p>Follow the example steps to install the multi-module project in your Eclipse.</p>
<ul>
<li>create a new workspace with Eclipse 3.3 and WTP 2.0</li>
<li>define the <tt>M2_REPO</tt> variable in Eclipse</li>
<li>extract the example project somewhere</li>
<li>start '<tt>mvn eclipse:eclipse install</tt>' from the command-line in the root project (j2ee-simple)</li>
<li>use the <a href="#Multi_Project_Import_Export_Plugin">Multi Project Import/Export Plugin</a> to import all the modules into Eclipse</li>
<li>define your favorite application server in the WTP Server view</li>
<li>add and publish the project to the server </li>
<li>start the server</li>
<li>open your browser to <a class="externalLink" href="http://localhost:8080/servlet/hello">http://localhost:8080/servlet/hello</a></li>
<li>your maven project is up and running as a eclipse / wtp project</li></ul></div></div>
<div class="section">
<h3><a name="Source_Control_Management"></a>Source Control Management</h3>
<p>Eclipse and Maven support a wide range of SCM systems (like CVS and SVN). The usage in a WTP/Maven project has some peculiarities, which we will discuss below.</p>
<div class="section">
<h4><a name="Control_files"></a>Control files</h4>
<p>Do not check in the Eclipse control files in your SCM, you can (and should) regenerate them every time you need them!</p>
<p>When using CVS, put these files in the .cvsignore file of every module. A basic version will look something like this:</p>
<div class="source"><pre class="prettyprint">.classpath
.project
.settings
target</pre></div>
<p>For SVN, use the svn:ignore property in the root directory of each project.</p></div>
<div class="section">
<h4><a name="The_organization_project"></a>The organization project</h4>
<p>One solution to sharing the exact Maven configuration between all developers, is to create a project containing the Maven binary release. This project can also be included in the SCM system, so that any updates (be it a new version or a configuration.change) are received by all developers.</p></div></div>
<div class="section">
<h3><a name="Multi_Project_Import.2FExport_Plugin"></a>Multi Project Import/Export Plugin</h3>
<p>There is an Eclipe plugin available that can help a lot when using multi-module projects. This plugin can import several projects at once, and it can do so from both a deep and a flat structure.</p>
<p>The plugin is called &quot;Multi Project Import/Export Plugin&quot; and can be found <a class="externalLink" href="http://eclipse-tools.sourceforge.net/">here</a>. You can also reference the update site in eclipse, using the URL: <b>http://eclipse-tools.sourceforge.net/updates/</b></p></div>
<div class="section">
<h3><a name="Project_names"></a>Project names</h3>
<p>The project names in Eclipse do not have to be the same as the name of the folder. Instead of forcing Maven to generate artifacts without version name (which is considered bad practice), the maven-eclipse-plugin can adapt the project names to include the version name! This way the artifact Eclipse generates, will have the same name as the artifact the Maven generates!</p>
<p>Many problems in the area of &quot;the eclipse exported ear works, but the maven generated not&quot; (or vice-versa) come from this different &quot;final name&quot; problem.</p>
<p>The best way to evade such problems is to use this setting for the maven-eclipse-plugin:</p>
<div class="source"><pre class="prettyprint">&lt;projectNameTemplate&gt;[artifactId]-[version]&lt;/projectNameTemplate&gt;</pre></div></div>
<div class="section">
<h3><a name="The_pom_modules"></a>The pom modules</h3>
<p>The root of the projects in Maven is always a POM-module. These projects can be imported into Eclipse as well, which then enables you to create and use <b>External Tool-launches</b> with workspace-locations. This makes the launches also exchangeable between developers and they can therefore also be stored in SCM.</p>
<div class="section">
<h4><a name="Duplicate_folders"></a>Duplicate folders</h4>
<p>Some peculiarities you will have to remember when you checked out the root pom project in your workspace:</p>
<ul>
<li>first synchronize the modules</li>
<li>then <b>refresh</b> the pom project (this step is <b>very</b> important!)</li>
<li>then synchonize the root pom project <br />(only necessary when the root pom changed or you created a new module)</li></ul>
<p>Watch out that the files accessible in modules under the root pom project, are <b>physically</b> the same files as in the imported projects. Eclipse will show the any changes after the next refresh.</p></div></div>
<div class="section">
<h3><a name="Maven_builds_as_launches"></a>Maven builds as launches</h3>
<p>As was said above, it is very useful to have your Maven builds inside Eclipse as a Launch-configuration. To create these, you should create a new External Tool and fill out the following values:</p>
<ul>
<li>Name:
<p>The name for the launch -- this can be chosen freely.</p></li>
<li>Location:
<div class="source"><pre class="prettyprint">  ${env_var:JAVA_HOME}/bin/java</pre></div>
<p>If you're on Windows, you should add the '.exe' extension to the above command.</p>
<p>Or, if you really want to make the builds interoperable, all developers should create a variable in their workspace called 'JAVA_EXECUTABLE', holding either the value 'java' (linux) or 'java.exe' (windows). The above command can then be changed into</p>
<div class="source"><pre class="prettyprint">  ${env_var:JAVA_HOME}/bin/${JAVA_EXECUTABLE}</pre></div></li>
<li>Working Directory: 
<p>Select the root pom project here.</p>
<div class="source"><pre class="prettyprint">  ${workspace_loc:/j2ee-simple}</pre></div></li>
<li>Arguments:
<p>In the example below, we presume you have made the organization-project containing the Maven distribution. The project is called 'organization'.</p>
<div class="source"><pre class="prettyprint">  -Dclassworlds.conf=${resource_loc:organization/maven-2.0/bin/m2.conf} 
  -Dmaven.home=${resource_loc:organization/maven-2.0}
  -classpath ${resource_loc:organization/maven-2.0/core/boot/classworlds-1.1.jar}
   org.codehaus.classworlds.Launcher

  -DdownloadSources=true
  -Dmaven.test.skip=${string_prompt:maven.test.skip:false}  
   clean eclipse:clean eclipse:eclipse install</pre></div>
<p>The last three lines are configurations for plugins and the actual goals to run. These can be changed if necessary.</p>
<p>The second to last line is used to have Eclipse prompt for running or skipping tests. Enter 'true' to skip the tests, anything else will run the tests.</p></li>
<li>Refresh / Refresh resources upon completion
<p>Best to activate &quot;The entire workspace&quot; just to be sure all projects are aware of changes.</p></li>
<li>Common / Save as Shared file
<p>Best to select the Root pom project location. The resulting launch file can be put under SCM control.</p></li></ul></div>
<div class="section">
<h3><a name="The_EAR_project"></a>The EAR project</h3>
<p>WTP saves some extra information in the application.xml that would otherwise be generated by the maven-ear-plugin. We do not want to interfere with the maven-ear-plugin, so the maven-eclipse-plugin generates a special application.xml for WTP. This enables you to use the WTP deployer in the server view.</p>
<p>Important: this generated version of the application.xml will <b>NOT</b> be used in the maven build.</p></div>
<div class="section">
<h3><a name="The_EJB_project"></a>The EJB project</h3>
<p>WTP automatically uses the ejbModule's source folder, but it is not mandatory. Use the Maven location instead: 'src/main/resources' for the ejb-jar.xml (etc) and 'src/main/java' for the JAVA-beans.</p>
<p>TIP: if WTP can not read your deployment descriptor, check if you included a 'display-name'-tag and specified the <i>xml encoding</i> in the xml file.</p></div>
<div class="section">
<h3><a name="The_WAR_project"></a>The WAR project</h3>
<p>Early versions of WTP had some problems when no toplevel directory was used for the webcontent. As of v1.5 this problem is no longer there! This enables using the standard maven directory 'src/main/webapp' as the web-content folder. </p>
<p>The WEB-INF/classes directory can still trigger problems, therefore it is best <b>not</b> to include JAVA classes in a war module. Just put them in a separate JAVA (JAR) module and a lot of undetermined problems disappear. </p>
<p>WTP needs the context root in the war project, but in Maven it is defined in the ear project. As long as the ear project is available in the reactor (as part of the same multi module build) the eclipse plugin will take the context root from the ear project configuration. </p></div>
<div class="section">
<h3><a name="The_Eclipse_MANIFEST_files"></a>The Eclipse MANIFEST files</h3>
<p>In Maven the manifest is generated by the maven-jar-plugin from the dependencies just before packaging, but WTP needs them to run. The maven-eclipse-plugin will generate a manifest that is available only to Eclipse (located at 'target/generated-resources/eclipse/META-INF/MANIFEST.MF'), meaning that it will be ignored in the normal maven build.</p></div>
<div class="section">
<h3><a name="Deploying_with_WTP"></a>Deploying with WTP</h3>
<p>When you followed all directions described here, there should be no problem to deploy your EARs using the WTP tools for your application server. So there is no need to start a maven build after every change. </p></div>
<div class="section">
<h3><a name="Finally"></a>Finally</h3>
<p>The configuration of the maven-eclipse-plugin used in this description is:</p>
<div class="source"><pre class="prettyprint">  &lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-eclipse-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.11.2&lt;/version&gt;
    &lt;configuration&gt;
      &lt;projectNameTemplate&gt;[artifactId]-[version]&lt;/projectNameTemplate&gt;
      &lt;wtpmanifest&gt;true&lt;/wtpmanifest&gt;
      &lt;wtpapplicationxml&gt;true&lt;/wtpapplicationxml&gt;
      &lt;wtpversion&gt;2.0&lt;/wtpversion&gt;
      &lt;manifest&gt;${basedir}/src/main/resources/META-INF/MANIFEST.MF&lt;/manifest&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>